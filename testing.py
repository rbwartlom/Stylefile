import requests
import time
import datetime
from bs4 import BeautifulSoup, SoupStrainer
from dhooks import Webhook

pagelink = "https://www.stylefile.de/suche?q=air+force+1&start=0&sz=50"
sendto_webhook = "https://discord.com/api/webhooks/822574588129968179/KVtDJPGx_90FWzbY6vL1GvJNE3KLdDoGfmsiNf8pEuYX6E4pCF6Tf1cWLBinnLrygRFF"


def find_all_items_stylefile(func_link):
    headers = {'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.102 Safari/537.36'}
    search_result_content = SoupStrainer('div', attrs={'class': 'search-result-content'})
    result = requests.get(func_link, 'lxml', headers=headers)
    soup = BeautifulSoup(result.content, "html.parser", parse_only=search_result_content)
    lists = soup.find_all('li', class_="grid-tile")
    dict_all_pids = dict()
    dict_keys = set()

    for item in lists:
        item_name_and_link = item.find('a', class_="thumb-link")
        item_name = item_name_and_link['title']
        item_link = item_name_and_link['href']
        pid = item.find('div', class_="product-tile")['data-producttilempid']
        dict_keys.add(pid)
        dict_all_pids[pid] = {"sku": pid, "name": item_name, "link": item_link}

    return dict_all_pids, dict_keys


def discord_send(text, local_dict=dict(), dict_keys=set()):
    hook = Webhook(sendto_webhook)
    item_info = str()
    dict_values = ["sku", "name", "link"]
    for key in dict_keys:
        for d in dict_values:
            item_info += local_dict[str(key)][d] + " | "
    hook.send(str(text + item_info))


def log(action):
    print(str(datetime.datetime.now()) + " " + action + str(len(keys_set_base)) + str(len(keys_set_new)), flush=True)



dict_base = {'CK6649-200': {'sku': 'CK6649-200', 'name': 'Air Force 1 Pixel', 'link': 'https://www.stylefile.de/nike-air-force-1-pixel-schuhe-beige-girls/P.SO5500028602.html'}, 'CW2289-111': {'sku': 'CW2289-111', 'name': "Air Force 1 Mid '07", 'link': 'https://www.stylefile.de/nike-air-force-1-mid-07-schuhe-wei%C3%9F-boys/P.SO55000431002.html'}, 'CT2302-100': {'sku': 'CT2302-100', 'name': "Air Force 1 '07", 'link': 'https://www.stylefile.de/nike-air-force-1-07-schuhe-wei%C3%9F-schwarz-boys/P.SO55000409003.html'}, 'CZ5093-100': {'sku': 'CZ5093-100', 'name': 'Air Force 1/1', 'link': 'https://www.stylefile.de/nike-air-force-1/1-schuhe-wei%C3%9F-boys/P.SO55000436001.html'}, 'CT1986-100': {'sku': 'CT1986-100', 'name': 'Air Force 1 Crater', 'link': 'https://www.stylefile.de/nike-air-force-1-crater-schuhe-wei%C3%9F-girls/P.SO5500031303.html'}, 'DB2812-100': {'sku': 'DB2812-100', 'name': ' Air Force 1/1', 'link': 'https://www.stylefile.de/nike-air-force-1/1-kinderschuhe-wei%C3%9F-boys/P.SO5500038102.html'}, 'CW2288-111': {'sku': 'CW2288-111', 'name': "Air Force 1 '07", 'link': 'https://www.stylefile.de/nike-air-force-1-07-schuhe-wei%C3%9F-boys/P.SO55000409009.html'}, 'CT1986-400': {'sku': 'CT1986-400', 'name': 'Air Force 1 Crater W', 'link': 'https://www.stylefile.de/nike-air-force-1-crater-w-schuhe-blau-girls/P.SO55000406002.html'}, 'CW2289-001': {'sku': 'CW2289-001', 'name': "Air Force 1 Mid '07", 'link': 'https://www.stylefile.de/nike-air-force-1-mid-07-schuhe-schwarz-boys/P.SO55000431001.html'}, 'CW1575-103': {'sku': 'CW1575-103', 'name': 'Air Force 1', 'link': 'https://www.stylefile.de/nike-air-force-1-kinderschuhe-wei%C3%9F-gruen-boys/P.SO5500037501.html'}, 'CK7214-100': {'sku': 'CK7214-100', 'name': 'Air Force 1 07 LV8', 'link': 'https://www.stylefile.de/nike-air-force-1-07-lv8-schuhe-wei%C3%9F-boys/P.SO55000186002.html'}, 'CT2858-001': {'sku': 'CT2858-001', 'name': 'Air Force 1 GTX', 'link': 'https://www.stylefile.de/nike-air-force-1-gtx-schuhe-schwarz-boys/P.SO5500032001.html'}, 'CT1986-001': {'sku': 'CT1986-001', 'name': 'Air Force 1 Crater', 'link': 'https://www.stylefile.de/nike-air-force-1-crater-schuhe-grau-girls/P.SO5500031301.html'}, 'CT2858-200': {'sku': 'CT2858-200', 'name': 'Air Force 1 GTX', 'link': 'https://www.stylefile.de/nike-air-force-1-gtx-schuhe-oliv-boys/P.SO5500032002.html'}, 'DB2812-001': {'sku': 'DB2812-001', 'name': ' Air Force 1/1', 'link': 'https://www.stylefile.de/nike-air-force-1/1-kinderschuhe-schwarz-boys/P.SO5500038101.html'}, 'CT1986-002': {'sku': 'CT1986-002', 'name': 'Air Force 1 Crater', 'link': 'https://www.stylefile.de/nike-air-force-1-crater-schuhe-schwarz-girls/P.SO5500031302.html'}, 'CV1724-100': {'sku': 'CV1724-100', 'name': "Air Force 1 '07", 'link': 'https://www.stylefile.de/nike-air-force-1-07-schuhe-wei%C3%9F-rot-boys/P.SO55000409004.html'}, 'CT1992-101': {'sku': 'CT1992-101', 'name': 'Air Force 1 07 SE', 'link': 'https://www.stylefile.de/nike-air-force-1-07-se-schuhe-beige-girls/P.SO5500031602.html'}, '315123-001': {'sku': '315123-001', 'name': 'Air Force 1 Mid 07', 'link': 'https://www.stylefile.de/nike-air-force-1-mid-07-schuhe-schwarz/P.SO55411002.html'}, 'CW5909-100': {'sku': 'CW5909-100', 'name': 'Air Force 1 LV8 KSA', 'link': 'https://www.stylefile.de/nike-air-force-1-lv8-ksa-kinderschuhe-wei%C3%9F-boys/P.SO5500037801.html'}, 'DJ2600-100': {'sku': 'DJ2600-100', 'name': 'Force 1 LV8 3', 'link': 'https://www.stylefile.de/nike-force-1-lv8-3-kinderschuhe-wei%C3%9F-boys/P.SO55000530001.html'}, 'CT1992-100': {'sku': 'CT1992-100', 'name': 'Air Force 1 07 SE', 'link': 'https://www.stylefile.de/nike-air-force-1-07-se-schuhe-wei%C3%9F-girls/P.SO5500031601.html'}, '314195-004': {'sku': '314195-004', 'name': 'Air Force 1 Mid Youth GS', 'link': 'https://www.stylefile.de/nike-air-force-1-mid-youth-gs-schuhe-schwarz-girls/P.SO55411802.html'}, 'CW1577-002': {'sku': 'CW1577-002', 'name': 'Air Force 1 LV8', 'link': 'https://www.stylefile.de/nike-air-force-1-lv8-kinderschuhe-schwarz-boys/P.SO5500037701.html'}, 'CT2299-001': {'sku': 'CT2299-001', 'name': 'Air Force 1 07 LV8', 'link': 'https://www.stylefile.de/nike-air-force-1-07-lv8-schuhe-schwarz-boys/P.SO5500031801.html'}, 'CI0051-001': {'sku': 'CI0051-001', 'name': 'Air Force 1 Flyknit 2', 'link': 'https://www.stylefile.de/nike-air-force-1-flyknit-2-schuhe-schwarz-boys/P.SO55000156001.html'}, 'CK7214-001': {'sku': 'CK7214-001', 'name': 'Air Force 1 07 LV8', 'link': 'https://www.stylefile.de/nike-air-force-1-07-lv8-schuhe-schwarz-boys/P.SO55000186001.html'}, 'CJ4093-300': {'sku': 'CJ4093-300', 'name': 'Air Force 1 LV8', 'link': 'https://www.stylefile.de/nike-air-force-1-lv8-kinderschuhe-tuerkis-neon-gruen/P.SO5500025202.html'}, 'CD6915-101': {'sku': 'CD6915-101', 'name': 'Air Force 1', 'link': 'https://www.stylefile.de/nike-air-force-1-kinderschuhe-wei%C3%9F-rot-girls/P.SO55414305.html'}, 'AR5339-201': {'sku': 'AR5339-201', 'name': 'Air Force 1 Sage Low W', 'link': 'https://www.stylefile.de/nike-air-force-1-sage-low-w-schuhe-pink-girls/P.SO55490405.html'}, 'AJ9502-600': {'sku': 'AJ9502-600', 'name': 'SF Air Force Mid Suede', 'link': 'https://www.stylefile.de/nike-sf-air-force-mid-suede-schuhe-pink/P.SO55485302.html'}}
keys_set_base = {'CT1986-400', 'CT2299-001', 'CJ4093-300', 'CT1992-101', 'CK6649-200', 'CT1986-001', 'AR5339-201', 'CW1575-103', 'CW2289-111', '314195-004', 'CW2288-111', 'CT1986-100', 'CW2289-001', 'AJ9502-600', 'CT1986-002', 'CZ5093-100', 'DJ2600-100', 'CI0051-001', 'CT1992-100', 'DB2812-001', 'DB2812-100', 'CT2858-200', 'CV1724-100', 'CW5909-100', 'CW1577-002', 'CK7214-001', 'CT2858-001', 'CK7214-100', 'CT2302-100', 'CD6915-101', '315123-001'}

dict_new = {'CK6649-200': {'sku': 'CK6649-200', 'name': 'Air Force 1 Pixel', 'link': 'https://www.stylefile.de/nike-air-force-1-pixel-schuhe-beige-girls/P.SO5500028602.html'}, 'CW2289-111': {'sku': 'CW2289-111', 'name': "Air Force 1 Mid '07", 'link': 'https://www.stylefile.de/nike-air-force-1-mid-07-schuhe-wei%C3%9F-boys/P.SO55000431002.html'}, 'CT2302-100': {'sku': 'CT2302-100', 'name': "Air Force 1 '07", 'link': 'https://www.stylefile.de/nike-air-force-1-07-schuhe-wei%C3%9F-schwarz-boys/P.SO55000409003.html'}, 'CZ5093-100': {'sku': 'CZ5093-100', 'name': 'Air Force 1/1', 'link': 'https://www.stylefile.de/nike-air-force-1/1-schuhe-wei%C3%9F-boys/P.SO55000436001.html'}, 'CT1986-100': {'sku': 'CT1986-100', 'name': 'Air Force 1 Crater', 'link': 'https://www.stylefile.de/nike-air-force-1-crater-schuhe-wei%C3%9F-girls/P.SO5500031303.html'}, 'DB2812-100': {'sku': 'DB2812-100', 'name': ' Air Force 1/1', 'link': 'https://www.stylefile.de/nike-air-force-1/1-kinderschuhe-wei%C3%9F-boys/P.SO5500038102.html'}, 'CW2288-111': {'sku': 'CW2288-111', 'name': "Air Force 1 '07", 'link': 'https://www.stylefile.de/nike-air-force-1-07-schuhe-wei%C3%9F-boys/P.SO55000409009.html'}, 'CT1986-400': {'sku': 'CT1986-400', 'name': 'Air Force 1 Crater W', 'link': 'https://www.stylefile.de/nike-air-force-1-crater-w-schuhe-blau-girls/P.SO55000406002.html'}, 'CW2289-001': {'sku': 'CW2289-001', 'name': "Air Force 1 Mid '07", 'link': 'https://www.stylefile.de/nike-air-force-1-mid-07-schuhe-schwarz-boys/P.SO55000431001.html'}, 'CW1575-103': {'sku': 'CW1575-103', 'name': 'Air Force 1', 'link': 'https://www.stylefile.de/nike-air-force-1-kinderschuhe-wei%C3%9F-gruen-boys/P.SO5500037501.html'}, 'CK7214-100': {'sku': 'CK7214-100', 'name': 'Air Force 1 07 LV8', 'link': 'https://www.stylefile.de/nike-air-force-1-07-lv8-schuhe-wei%C3%9F-boys/P.SO55000186002.html'}, 'CT2858-001': {'sku': 'CT2858-001', 'name': 'Air Force 1 GTX', 'link': 'https://www.stylefile.de/nike-air-force-1-gtx-schuhe-schwarz-boys/P.SO5500032001.html'}, 'CT1986-001': {'sku': 'CT1986-001', 'name': 'Air Force 1 Crater', 'link': 'https://www.stylefile.de/nike-air-force-1-crater-schuhe-grau-girls/P.SO5500031301.html'}, 'CT2858-200': {'sku': 'CT2858-200', 'name': 'Air Force 1 GTX', 'link': 'https://www.stylefile.de/nike-air-force-1-gtx-schuhe-oliv-boys/P.SO5500032002.html'}, 'DB2812-001': {'sku': 'DB2812-001', 'name': ' Air Force 1/1', 'link': 'https://www.stylefile.de/nike-air-force-1/1-kinderschuhe-schwarz-boys/P.SO5500038101.html'}, 'CT1986-002': {'sku': 'CT1986-002', 'name': 'Air Force 1 Crater', 'link': 'https://www.stylefile.de/nike-air-force-1-crater-schuhe-schwarz-girls/P.SO5500031302.html'}, 'CV1724-100': {'sku': 'CV1724-100', 'name': "Air Force 1 '07", 'link': 'https://www.stylefile.de/nike-air-force-1-07-schuhe-wei%C3%9F-rot-boys/P.SO55000409004.html'}, 'CT1992-101': {'sku': 'CT1992-101', 'name': 'Air Force 1 07 SE', 'link': 'https://www.stylefile.de/nike-air-force-1-07-se-schuhe-beige-girls/P.SO5500031602.html'}, '315123-001': {'sku': '315123-001', 'name': 'Air Force 1 Mid 07', 'link': 'https://www.stylefile.de/nike-air-force-1-mid-07-schuhe-schwarz/P.SO55411002.html'}, 'CW5909-100': {'sku': 'CW5909-100', 'name': 'Air Force 1 LV8 KSA', 'link': 'https://www.stylefile.de/nike-air-force-1-lv8-ksa-kinderschuhe-wei%C3%9F-boys/P.SO5500037801.html'}, 'DJ2600-100': {'sku': 'DJ2600-100', 'name': 'Force 1 LV8 3', 'link': 'https://www.stylefile.de/nike-force-1-lv8-3-kinderschuhe-wei%C3%9F-boys/P.SO55000530001.html'}, 'CT1992-100': {'sku': 'CT1992-100', 'name': 'Air Force 1 07 SE', 'link': 'https://www.stylefile.de/nike-air-force-1-07-se-schuhe-wei%C3%9F-girls/P.SO5500031601.html'}, '314195-004': {'sku': '314195-004', 'name': 'Air Force 1 Mid Youth GS', 'link': 'https://www.stylefile.de/nike-air-force-1-mid-youth-gs-schuhe-schwarz-girls/P.SO55411802.html'}, 'CW1577-002': {'sku': 'CW1577-002', 'name': 'Air Force 1 LV8', 'link': 'https://www.stylefile.de/nike-air-force-1-lv8-kinderschuhe-schwarz-boys/P.SO5500037701.html'}, 'CT2299-001': {'sku': 'CT2299-001', 'name': 'Air Force 1 07 LV8', 'link': 'https://www.stylefile.de/nike-air-force-1-07-lv8-schuhe-schwarz-boys/P.SO5500031801.html'}, 'CI0051-001': {'sku': 'CI0051-001', 'name': 'Air Force 1 Flyknit 2', 'link': 'https://www.stylefile.de/nike-air-force-1-flyknit-2-schuhe-schwarz-boys/P.SO55000156001.html'}, 'CK7214-001': {'sku': 'CK7214-001', 'name': 'Air Force 1 07 LV8', 'link': 'https://www.stylefile.de/nike-air-force-1-07-lv8-schuhe-schwarz-boys/P.SO55000186001.html'}, 'CJ4093-300': {'sku': 'CJ4093-300', 'name': 'Air Force 1 LV8', 'link': 'https://www.stylefile.de/nike-air-force-1-lv8-kinderschuhe-tuerkis-neon-gruen/P.SO5500025202.html'}, 'CD6915-101': {'sku': 'CD6915-101', 'name': 'Air Force 1', 'link': 'https://www.stylefile.de/nike-air-force-1-kinderschuhe-wei%C3%9F-rot-girls/P.SO55414305.html'}, 'AR5339-201': {'sku': 'AR5339-201', 'name': 'Air Force 1 Sage Low W', 'link': 'https://www.stylefile.de/nike-air-force-1-sage-low-w-schuhe-pink-girls/P.SO55490405.html'}, 'AJ9502-600': {'sku': 'AJ9502-600', 'name': 'SF Air Force Mid Suede', 'link': 'https://www.stylefile.de/nike-sf-air-force-mid-suede-schuhe-pink/P.SO55485302.html'}}
keys_set_new = {'CT1986-400', 'CT2299-001', 'CJ4093-300', 'CT1992-101', 'CK6649-200', 'CT1986-001', 'AR5339-201', 'CW1575-103', 'CW2289-111', '314195-004', 'CW2288-111', 'CT1986-100', 'CW2289-001', 'AJ9502-600', 'CT1986-002', 'CZ5093-100', 'DJ2600-100', 'CI0051-001', 'CT1992-100', 'DB2812-001', 'DB2812-100', 'CT2858-200', 'CV1724-100', 'CW5909-100', 'CW1577-002', 'CK7214-001', 'CT2858-001', 'CK7214-100', 'CT2302-100', 'CD6915-101', '315123-001'}
if len(keys_set_new) > len(keys_set_base):
    discord_send("New item: ", dict_new, (keys_set_new - keys_set_base))
    log("change")
elif len(keys_set_new) < len(keys_set_base):
    discord_send("Item removed: ", dict_new, (keys_set_base - keys_set_new))
    log("change")
elif len(keys_set_new) == len(keys_set_base):
    log("success")
else:
    print("error1")





